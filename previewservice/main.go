package main

import (
	"fmt"
	"log"

	"shortLink/previewservice/preview"
)

func main() {
	// æµ‹è¯•ç½‘é¡µåœ°å€ï¼ˆæ¨èä½¿ç”¨å¸¦æœ‰ Open Graph æ ‡ç­¾çš„ç½‘é¡µï¼‰
	targetURL := "https://cloud.tencent.com/developer/article/1776068"

	fmt.Println("ğŸ” å¼€å§‹æå–ç½‘é¡µä¿¡æ¯:", targetURL)

	// ç¬¬ä¸€æ­¥ï¼šæå– OG æ ‡ç­¾
	og, err := preview.FetchOGTagsA(targetURL)
	if err != nil {
		log.Fatalf("âŒ æå– OG æ ‡ç­¾å¤±è´¥: %v", err)
	}
	content := fmt.Sprintf("content:%v", og)

	// ç¬¬äºŒæ­¥ï¼šè°ƒç”¨ LLM æ‘˜è¦ï¼ˆå¯é€‰ï¼Œè§†æƒ…å†µå¯ç”¨ï¼‰
	fmt.Println("\nğŸ¤– ä½¿ç”¨ OpenAI ç”Ÿæˆæ‘˜è¦...")
	summary, err := preview.GenerateSummary(content)
	if err != nil {
		log.Fatalf("âŒ æ‘˜è¦ç”Ÿæˆå¤±è´¥: %v", err)
	}
	fmt.Println("âœ… æ‘˜è¦ç”Ÿæˆ:")
	fmt.Println(summary)
}

// import (
// 	"bytes"
// 	"encoding/json"
// 	"fmt"
// 	"io/ioutil"
// 	"net/http"
// )

// func main() {
// 	url := "https://spark-api-open.xf-yun.com/v1/chat/completions"
// 	apiKey := "vlqaanDeQlNHXBvuKmYR:BDAQwEALbtjgORamizGp" // TODOï¼šæ›¿æ¢ä¸ºä½ è‡ªå·±çš„ API Password

// 	// æ„é€ è¯·æ±‚ä½“
// 	requestBody := map[string]interface{}{
// 		"model": "4.0Ultra",
// 		"messages": []map[string]string{
// 			{
// 				"role":    "user",
// 				"content": "ä½ æ˜¯è°",
// 			},
// 		},
// 	}

// 	jsonData, err := json.Marshal(requestBody)
// 	if err != nil {
// 		fmt.Println("âŒ JSON åºåˆ—åŒ–å¤±è´¥:", err)
// 		return
// 	}

// 	// åˆ›å»ºè¯·æ±‚
// 	req, err := http.NewRequest("POST", url, bytes.NewBuffer(jsonData))
// 	if err != nil {
// 		fmt.Println("âŒ è¯·æ±‚åˆ›å»ºå¤±è´¥:", err)
// 		return
// 	}
// 	req.Header.Set("Content-Type", "application/json")
// 	req.Header.Set("Authorization", "Bearer "+apiKey)

// 	// å‘é€è¯·æ±‚
// 	client := &http.Client{}
// 	resp, err := client.Do(req)
// 	if err != nil {
// 		fmt.Println("âŒ è¯·æ±‚å‘é€å¤±è´¥:", err)
// 		return
// 	}
// 	defer resp.Body.Close()

// 	// è¯»å–å“åº”
// 	body, err := ioutil.ReadAll(resp.Body)
// 	if err != nil {
// 		fmt.Println("âŒ å“åº”è¯»å–å¤±è´¥:", err)
// 		return
// 	}

// 	fmt.Println("âœ… å“åº”å†…å®¹ï¼š")
// 	fmt.Println(string(body))
// }
